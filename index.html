<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Ollama Chat Room</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; background-color: #f7f7f7; display: flex; flex-direction: column; height: 95vh; }
        h1 { text-align: center; color: #333; }
        #chat-window { flex-grow: 1; border: 1px solid #ccc; border-radius: 8px; overflow-y: auto; padding: 15px; background-color: #fff; margin-bottom: 15px; }
        .message { margin-bottom: 15px; line-height: 1.5; }
        .user-message { text-align: right; }
        .user-message .content { background-color: #007bff; color: white; padding: 10px 15px; border-radius: 15px 15px 0 15px; display: inline-block; }
        .bot-message .content { background-color: #e9e9eb; color: #333; padding: 10px 15px; border-radius: 15px 15px 15px 0; display: inline-block; white-space: pre-wrap; }
        #input-area { display: flex; }
        #prompt-input { flex-grow: 1; padding: 10px; border: 1px solid #ccc; border-radius: 8px 0 0 8px; outline: none; }
        #send-button { padding: 10px 20px; border: none; background-color: #007bff; color: white; cursor: pointer; border-radius: 0 8px 8px 0; }
        #send-button:disabled { background-color: #aaa; }
    </style>
</head>
<body>
    <h1>Chat with phi3</h1>
    <div id="chat-window"></div>
    <div id="input-area">
        <input type="text" id="prompt-input" placeholder="INPUT HERE..." autocomplete="off">
        <button id="send-button">SEND</button>
    </div>

    <script>
        const chatWindow = document.getElementById('chat-window');
        const promptInput = document.getElementById('prompt-input');
        const sendButton = document.getElementById('send-button');

        const sendMessage = async () => {
            const prompt = promptInput.value.trim();
            if (!prompt) return;

            appendMessage('你', prompt, 'user');
            promptInput.value = '';
            sendButton.disabled = true;
            
            const thinkingMessage = appendMessage('phi3', 'thinking...', 'bot');

            try {
                const response = await fetch('/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ prompt: prompt, model: 'phi3' })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || `伺服器錯誤: ${response.status}`);
                }

                const data = await response.json();
                thinkingMessage.querySelector('.content').textContent = data.response;

            } catch (error) {
                console.error('ERROR:', error);
                thinkingMessage.querySelector('.content').textContent = `發生錯誤: ${error.message}`;
            } finally {
                sendButton.disabled = false;
                promptInput.focus();
                chatWindow.scrollTop = chatWindow.scrollHeight;
            }
        };

        const appendMessage = (sender, text, type) => {
            const messageElement = document.createElement('div');
            messageElement.classList.add('message', `${type}-message`);
            const contentElement = document.createElement('div');
            contentElement.classList.add('content');
            contentElement.textContent = text;
            messageElement.appendChild(contentElement);
            chatWindow.appendChild(messageElement);
            chatWindow.scrollTop = chatWindow.scrollHeight;
            return messageElement;
        };

        sendButton.addEventListener('click', sendMessage);
        promptInput.addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
                sendMessage();
            }
        });
    </script>
</body>
</html>
